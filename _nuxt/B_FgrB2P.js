const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./COjx-RVV.js","./Cpz06zdE.js","./DwDIoCYD.js"])))=>i.map(i=>d[i]);
import{ab as L,N as U,ad as D,_ as R}from"./Cpz06zdE.js";import{t as k}from"./DwDIoCYD.js";const b=(i,s)=>{const t=i._conditions;return t.length>0?`(${t.join(` ${s} `)})`:""},w=i=>{const s=[],t={_conditions:s,where(n,r,e){let a;switch(r.toUpperCase()){case"IN":case"NOT IN":if(Array.isArray(e)){const u=e.map(d=>y(d)).join(", ");a=`"${String(n)}" ${r.toUpperCase()} (${u})`}else throw new TypeError(`Value for ${r} must be an array`);break;case"BETWEEN":case"NOT BETWEEN":if(Array.isArray(e)&&e.length===2)a=`"${String(n)}" ${r.toUpperCase()} ${y(e[0])} AND ${y(e[1])}`;else throw new Error(`Value for ${r} must be an array with two elements`);break;case"IS NULL":case"IS NOT NULL":a=`"${String(n)}" ${r.toUpperCase()}`;break;case"LIKE":case"NOT LIKE":a=`"${String(n)}" ${r.toUpperCase()} ${y(e)}`;break;default:a=`"${String(n)}" ${r} ${y(typeof e=="boolean"?Number(e):e)}`}return s.push(`${a}`),t},andWhere(n){const r=n(w());return s.push(b(r,"AND")),t},orWhere(n){const r=n(w());return s.push(b(r,"OR")),t}};return t},B=(i,s)=>{const t={conditions:[],selectedFields:[],offset:0,limit:0,orderBy:[],count:{field:"",distinct:!1}},n={__params:t,andWhere(e){const a=e(w());return t.conditions.push(b(a,"AND")),n},orWhere(e){const a=e(w());return t.conditions.push(b(a,"OR")),n},path(e){return n.where("path","=",L(e))},skip(e){return t.offset=e,n},where(e,a,u){return n.andWhere(d=>d.where(String(e),a,u)),n},limit(e){return t.limit=e,n},select(...e){return e.length&&t.selectedFields.push(...e),n},order(e,a){return t.orderBy.push(`"${String(e)}" ${a}`),n},async all(){return s(i,r()).then(e=>e||[])},async first(){return s(i,r({limit:1})).then(e=>e[0]||null)},async count(e="*",a=!1){return s(i,r({count:{field:String(e),distinct:a}})).then(u=>u[0].count)}};function r(e={}){let a="SELECT ";if(e!=null&&e.count)a+=`COUNT(${e.count.distinct?"DISTINCT ":""}${e.count.field}) as count`;else{const d=Array.from(new Set(t.selectedFields));a+=d.length>0?d.map($=>`"${String($)}"`).join(", "):"*"}a+=` FROM ${k[String(i)]}`,t.conditions.length>0&&(a+=` WHERE ${t.conditions.join(" AND ")}`),t.orderBy.length>0?a+=` ORDER BY ${t.orderBy.join(", ")}`:a+=" ORDER BY stem ASC";const u=(e==null?void 0:e.limit)||t.limit;return u>0&&(t.offset>0?a+=` LIMIT ${u} OFFSET ${t.offset}`:a+=` LIMIT ${u}`),a}return n};function y(i){return`'${String(i).replace(/'/g,"''")}'`}function W(i){return s=>(s=s||{},(i||[]).filter(t=>typeof s[t]<"u").reduce((t,n)=>Object.assign(t,{[n]:s[n]}),{}))}async function x(i,s=[]){var $;const t=i.__params;($=t==null?void 0:t.orderBy)!=null&&$.length||(i=i.order("stem","ASC"));const n=await i.orWhere(o=>o.where("navigation","<>","false").where("navigation","IS NULL")).select("navigation","stem","path","title","meta",...s||[]).all(),{contents:r,configs:e}=n.reduce((o,c)=>{var g;if(String(c.stem).split("/").pop()===".navigation"){c.title=((g=c.title)==null?void 0:g.toLowerCase())==="navigation"?"":c.title;const m=c.path.split("/").slice(0,-1).join("/")||"/";o.configs[m]={...c,...c.body}}else o.contents.push(c);return o},{configs:{},contents:[]}),a=o=>({...W(["title",...s])(o),...o.meta,..._(o==null?void 0:o.navigation)?o.navigation:{}}),u=o=>({...W(["title",...s])(o),..._(o==null?void 0:o.navigation)?o.navigation:{}}),d=r.reduce((o,c)=>{var v;const g=c.path.substring(1).split("/"),m=c.stem.split("/"),O=!!((v=m[m.length-1])!=null&&v.match(/([1-9]\d*\.)?index/g)),T=l=>({title:l.title,path:l.path,stem:l.stem,children:[],...u(l)}),h=T(c);if(O){const l=e[h.path];if(typeof(l==null?void 0:l.navigation)<"u"&&(l==null?void 0:l.navigation)===!1)return o;if(c.path!=="/"){const f=T(c);h.children.push(f)}l&&Object.assign(h,a(l))}if(g.length===1){const l=o.find(f=>f.path===h.path&&f.page===!1);return O&&l?Object.assign(l,{page:void 0,children:[...h.children||[],...l.children||[]]}):o.push(h),o}const C=g.slice(0,-1).reduce((l,f,A)=>{const I="/"+g.slice(0,A+1).join("/"),p=e[I];if(typeof(p==null?void 0:p.navigation)<"u"&&p.navigation===!1)return[];let S=l.find(N=>N.path===I);if(!S){const N=p?a(p):{};S={...N,title:N.title||P(f),path:I,stem:m.slice(0,A+1).join("/"),children:[],page:!1},l.push(S)}return S.children},o),E=C.find(l=>l.path===h.path&&l.page===!1);return E?Object.assign(E,{...h,page:void 0,children:[...h.children||[],...E.children||[]]}):C.push(h),o},[]);return j(d)}function j(i){var t;const s=i;for(const n of s)(t=n.children)!=null&&t.length?j(n.children):delete n.children;return i}function _(i){return i!==null&&Object.prototype.toString.call(i)==="[object Object]"}const P=i=>i.split(/[\s-]/g).map(U).join(" "),q=i=>{var t,n;const s=(n=(t=D())==null?void 0:t.ssrContext)==null?void 0:n.event;return B(i,(r,e)=>F(s,r,e))};function K(i,s){return M(i,t=>x(t,s))}async function F(i,s,t){return Q(s,t)}async function Q(i,s){return await R(()=>import("./COjx-RVV.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(n=>n.loadDatabaseAdapter(i)).then(n=>n.all(s))}function M(i,s){const t=q(i),n={where(r,e,a){return t.where(String(r),e,a),n},andWhere(r){return t.andWhere(r),n},orWhere(r){return t.orWhere(r),n},order(r,e){return t.order(String(r),e),n},then(r,e){return s(t).then(r,e)},catch(r){return this.then(void 0,r)},finally(r){return this.then(void 0,void 0).finally(r)},get[Symbol.toStringTag](){return"Promise"}};return n}export{K as a,q};
